delivers:
  - name: DTAGENT_DB
    type: database
  - name: DTAGENT_OWNER
    type: role
    comment: role that owns all SnowAgent artifacts (database, schemas, tables, procedures, tasks)
  - name: DTAGENT_ADMIN
    type: role
    optional: true
    config_key: core.snowflake.roles.admin
    comment: >
      (Optional - created only when core.snowflake.roles.admin is not set to "-") Role that handles elevated administrative operations (role
      grants, ownership transfers, privilege management). When disabled, admin deployment scope cannot be used.
  - name: DTAGENT_VIEWER
    type: role
    comment: role that executes regular telemetry collection and processing operations
  - name: DTAGENT_WH
    type: warehouse
  - name: DTAGENT_RS
    type: resource monitor
    optional: true
    config_key: core.snowflake.resource_monitor.name
    comment: >
      (Optional - created only when core.snowflake.resource_monitor.name is not set to "-") Resource monitor for controlling credit
      consumption. When disabled, no resource monitoring will be applied to the warehouse.
  - name: DTAGENT_API_INTEGRATION
    type: external access integration
  - name: DTAGENT_DB.PUBLIC
    type: schema
  - name: DTAGENT_DB.CONFIG
    type: schema
  - name: DTAGENT_DB.CONFIG.CONFIGURATIONS
    type: table
  - name: DTAGENT_DB.CONFIG.DTAGENT_API_KEY
    type: secret
  - name: DTAGENT_DB.CONFIG.DTAGENT_NETWORK_RULE
    type: network rule
  - name: DTAGENT_DB.CONFIG.UPDATE_FROM_CONFIGURATIONS()
    type: procedure
  - name: DTAGENT_DB.CONFIG.UPDATE_ALL_PLUGINS_SCHEDULE()
    type: procedure
  - name: DTAGENT_DB.CONFIG.UPDATE_PLUGIN_SCHEDULE(varchar,array)
    type: procedure
  - name: DTAGENT_DB.CONFIG.P_UPDATE_RESOURCE_MONITOR(int)
    type: procedure
    optional: true
    config_key: core.snowflake.resource_monitor.name
    comment: Only created when resource monitor is enabled
  - name: DTAGENT_DB.STATUS
    type: schema
  - name: DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG
    type: table
  - name: DTAGENT_DB.STATUS.LOG_PROCESSED_MEASUREMENTS(text,text,text,text)
    type: function
  - name: DTAGENT_DB.APP
    type: schema
  - name: DTAGENT_DB.CONFIG.F_GET_CONFIG_VALUE(text,variant)
    type: function
  - name: DTAGENT_DB.STATUS.F_LAST_PROCESSED_TS(text)
    type: function
  - name: DTAGENT_DB.APP.SEND_TELEMETRY(variant,object)
    type: procedure
    language: python
  - name: DTAGENT_DB.APP.DTAGENT(array)
    type: procedure
    language: python
references:
  - name: SNOWFLAKE
    type: application
    privileges: IMPORTED PRIVILEGES ON DATABASE
    granted to: DTAGENT_VIEWER
  - name: ACCOUNT
    type: account
    privileges:
      - MONITOR
      - MONITOR USAGE
      - MONITOR EXECUTION
    granted to: DTAGENT_VIEWER
  - name: ACCOUNT
    type: account
    privileges: MODIFY SESSION LOG LEVEL
    granted to: DTAGENT_VIEWER
  - name: ACCOUNT
    type: account
    privileges:
      - MANAGE GRANTS
      - EXECUTE TASK
    granted to: DTAGENT_ADMIN
    optional: true
    config_key: core.snowflake.roles.admin
    comment: Only granted when admin role is enabled
  - name: ACCOUNT
    type: account
    privileges:
      - EXECUTE TASK
    granted to: DTAGENT_VIEWER
  - name: DATABASE DTAGENT_DB
    type: database
    privileges:
      - OPERATE on all TASKS
      - OPERATE on future TASKS
    granted to: DTAGENT_VIEWER
