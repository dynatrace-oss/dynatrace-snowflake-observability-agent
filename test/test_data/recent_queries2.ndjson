{"QUERY_ID": "01bcb05d-0415-b618-0047-e383330c174a", "QUERY_OPERATOR_STATS": null, "PARENT_QUERY_ID": "01bcb05d-0415-b618-0047-e383330c172e", "SESSION_ID": 20234875336090534, "NAME": "select DTAGENT_DB", "START_TIME": 1760681131568692000, "END_TIME": 1760681133488692000, "_SPAN_ID": null, "_TRACE_ID": null, "STATUS_CODE": "OK", "DIMENSIONS": "{\n  \"db.collection.name\": \"DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG\",\n  \"db.namespace\": \"DTAGENT_DB\",\n  \"db.operation.name\": \"SELECT\",\n  \"db.snowflake.dbs\": [\n    \"DTAGENT_DB\"\n  ],\n  \"db.user\": \"SYSTEM\",\n  \"snowflake.query.execution_status\": \"SUCCESS\",\n  \"snowflake.role.name\": \"DTAGENT_ADMIN\",\n  \"snowflake.warehouse.name\": \"DTAGENT_WH\"\n}", "ATTRIBUTES": "{\n  \"db.query.text\": \"with cte_all_queries as (\\n            (\\n                select * from TABLE(result_scan(:QID_0))\\n            )\\n            union all\\n            (\\n                select * from TABLE(result_scan(:QID_1))\\n                where END_TIME > DTAGENT_DB.APP.F_LAST_PROCESSED_TS('active_queries')\\n            )\\n        )\\n        , cte_active_queries as (\\n            select \\n                START_TIME,\\n                END_TIME,\\n\\n                QUERY_ID,\\n                SESSION_ID,\\n                DATABASE_NAME,\\n                SCHEMA_NAME,\\n\\n                QUERY_TEXT,\\n                QUERY_TYPE,\\n                QUERY_TAG,\\n                QUERY_HASH,\\n                QUERY_HASH_VERSION,\\n                QUERY_PARAMETERIZED_HASH,\\n                QUERY_PARAMETERIZED_HASH_VERSION,\\n\\n                USER_NAME,\\n                ROLE_NAME,\\n\\n                WAREHOUSE_NAME,\\n                WAREHOUSE_TYPE,\\n\\n                EXECUTION_STATUS,\\n                ERROR_CODE,\\n                ERROR_MESSAGE,\\n\\n                // metrics\\n                RUNNING_TIME,\\n                EXECUTION_TIME,\\n                COMPILATION_TIME,\\n                TOTAL_ELAPSED_TIME,\\n                BYTES_WRITTEN_TO_RESULT,\\n                ROWS_WRITTEN_TO_RESULT,\\n            from cte_all_queries aq\\n            where\\n                ( array_size(DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])) = 0\\n            or array_contains(EXECUTION_STATUS::variant, DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])::array) )\\n        )\\n        select \\n            qh.END_TIME::timestamp_ltz                                                                                          as TIMESTAMP,\\n\\n            qh.query_id                                                                                                         as QUERY_ID,\\n            qh.session_id                                                                                                       as SESSION_ID,\\n\\n            CONCAT(\\n                'SQL query ',\\n                qh.execution_status,\\n                ' at ',\\n                COALESCE(qh.database_name, '')\\n            )                                                                                                                   as NAME,\\n            NAME                                                                                                                as _MESSAGE,\\n\\n            \\n            extract(epoch_nanosecond from qh.start_time)                                                                        as START_TIME,\\n            extract(epoch_nanosecond from qh.end_time)                                                                          as END_TIME,\\n\\n            \\n            OBJECT_CONSTRUCT(\\n                'db.namespace',                                             qh.database_name,\\n                'snowflake.warehouse.name',                                 qh.warehouse_name,\\n                'db.user',                                                  qh.user_name,\\n                'snowflake.role.name',                                      qh.role_name,\\n                'snowflake.query.execution_status',                         qh.execution_status\\n            )                                                                                                                   as DIMENSIONS,\\n            \\n            OBJECT_CONSTRUCT(\\n                'db.query.text',                                            qh.query_text,\\n                'db.operation.name',                                        qh.query_type,\\n                'session.id',                                               qh.session_id,\\n                'snowflake.query.id',                                       qh.query_id,\\n                'snowflake.query.tag',                                      qh.query_tag,\\n                'snowflake.query.hash',                                     qh.query_hash,\\n                'snowflake.query.hash_version',                             qh.query_hash_version,\\n                'snowflake.query.parametrized_hash',                        qh.query_parameterized_hash,\\n                'snowflake.query.parametrized_hash_version',                qh.query_parameterized_hash_version,\\n                'snowflake.error.code',                                     qh.error_code,\\n                'snowflake.error.message',                                  qh.error_message,\\n                'snowflake.warehouse.type',                                 qh.warehouse_type,\\n                'snowflake.schema.name',                                    qh.schema_name\\n            )                                                                                                                   as ATTRIBUTES,\\n            \\n            OBJECT_CONSTRUCT(\\n                'snowflake.time.running',                                   qh.running_time,\\n                'snowflake.time.execution',                                   qh.execution_time,\\n                'snowflake.time.compilation',                               qh.compilation_time,\\n                'snowflake.time.total_elapsed',                             qh.total_elapsed_time,\\n                'snowflake.data.written_to_result',                         qh.bytes_written_to_result,\\n                'snowflake.rows.written_to_result',                         qh.rows_written_to_result\\n            )                                                                                                                   as METRICS\\n        from \\n            cte_active_queries qh\\n        order by \\n            TIMESTAMP asc\",\n  \"db.snowflake.tables\": [\n    \"DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG\",\n    \"DTAGENT_DB.CONFIG.CONFIGURATIONS\"\n  ],\n  \"db.snowflake.views\": [],\n  \"session.id\": 20234875336090534,\n  \"snowflake.cluster_number\": 1,\n  \"snowflake.database.id\": 1868,\n  \"snowflake.query.hash\": \"dbf5cf366b64603513aa8097d5d3174c\",\n  \"snowflake.query.hash_version\": 2,\n  \"snowflake.query.id\": \"01bcb05d-0415-b618-0047-e383330c174a\",\n  \"snowflake.query.is_client_generated\": false,\n  \"snowflake.query.parametrized_hash\": \"dbf5cf366b64603513aa8097d5d3174c\",\n  \"snowflake.query.parametrized_hash_version\": 1,\n  \"snowflake.query.parent_id\": \"01bcb05d-0415-b618-0047-e383330c172e\",\n  \"snowflake.query.tag\": \"dt_snowagent.version:0.8.1.plugin:ActiveQueriesPlugin.2025-05-30T04:53:15.857Z\",\n  \"snowflake.query.transaction_id\": 0,\n  \"snowflake.release_version\": \"9.14.2\",\n  \"snowflake.role.type\": \"ROLE\",\n  \"snowflake.schema.id\": 40234,\n  \"snowflake.schema.name\": \"APP\",\n  \"snowflake.warehouse.cluster.number\": 1,\n  \"snowflake.warehouse.id\": 3726,\n  \"snowflake.warehouse.size\": \"X-Small\",\n  \"snowflake.warehouse.type\": \"STANDARD\"\n}", "METRICS": "{\n  \"snowflake.acceleration.data.scanned\": 0,\n  \"snowflake.acceleration.partitions.scanned\": 0,\n  \"snowflake.acceleration.scale_factor.max\": 0,\n  \"snowflake.credits.cloud_services\": 9.200000000000000e-05,\n  \"snowflake.data.deleted\": 0,\n  \"snowflake.data.read.from_result\": 0,\n  \"snowflake.data.scanned\": 5640704,\n  \"snowflake.data.scanned_from_cache\": 0.000000000000000e+00,\n  \"snowflake.data.sent_over_the_network\": 0,\n  \"snowflake.data.spilled.local\": 0,\n  \"snowflake.data.spilled.remote\": 0,\n  \"snowflake.data.transferred.inbound\": 0,\n  \"snowflake.data.transferred.outbound\": 0,\n  \"snowflake.data.written\": 0,\n  \"snowflake.data.written_to_result\": 117512,\n  \"snowflake.external_functions.data.received\": 0,\n  \"snowflake.external_functions.data.sent\": 0,\n  \"snowflake.external_functions.invocations\": 0,\n  \"snowflake.external_functions.rows.received\": 0,\n  \"snowflake.external_functions.rows.sent\": 0,\n  \"snowflake.load.used\": 100,\n  \"snowflake.partitions.scanned\": 47,\n  \"snowflake.partitions.total\": 43,\n  \"snowflake.rows.deleted\": 0,\n  \"snowflake.rows.inserted\": 0,\n  \"snowflake.rows.unloaded\": 0,\n  \"snowflake.rows.updated\": 0,\n  \"snowflake.rows.written_to_result\": 798,\n  \"snowflake.time.child_queries_wait\": 0,\n  \"snowflake.time.compilation\": 520,\n  \"snowflake.time.execution\": 1381,\n  \"snowflake.time.list_external_files\": 19,\n  \"snowflake.time.queued.overload\": 0,\n  \"snowflake.time.queued.provisioning\": 0,\n  \"snowflake.time.repair\": 0,\n  \"snowflake.time.total_elapsed\": 1920,\n  \"snowflake.time.transaction_blocked\": 0\n}", "IS_PARENT": false, "IS_ROOT": false}
{"QUERY_ID": "01bcb05d-0415-b618-0047-e383330c172e", "QUERY_OPERATOR_STATS": null, "PARENT_QUERY_ID": "01bcb05d-0415-b618-0047-e383330c172a", "SESSION_ID": 20234875336090534, "NAME": "call DTAGENT_DB", "START_TIME": 1760681131568872000, "END_TIME": 1760681138304872000, "_SPAN_ID": "4328cfa95b61ec83", "_TRACE_ID": "01bcb05d68938b78428142dea30a6160", "STATUS_CODE": "OK", "DIMENSIONS": "{\n  \"db.collection.name\": \"DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG\",\n  \"db.namespace\": \"DTAGENT_DB\",\n  \"db.operation.name\": \"CALL\",\n  \"db.snowflake.dbs\": [\n    \"DTAGENT_DB\"\n  ],\n  \"db.user\": \"SYSTEM\",\n  \"snowflake.query.execution_status\": \"SUCCESS\",\n  \"snowflake.role.name\": \"DTAGENT_ADMIN\",\n  \"snowflake.warehouse.name\": \"DTAGENT_WH\"\n}", "ATTRIBUTES": "{\n  \"db.query.text\": \"with cte_all_queries as (\\n            (\\n                select * from TABLE(DTAGENT_DB.APP.F_GET_RUNNING_QUERIES())\\n            )\\n            union all\\n            (\\n                select * from TABLE(DTAGENT_DB.APP.F_GET_FINISHED_QUERIES())\\n                where END_TIME > DTAGENT_DB.APP.F_LAST_PROCESSED_TS('active_queries')\\n            )\\n        )\\n        , cte_active_queries as (\\n            select \\n                START_TIME,\\n                END_TIME,\\n\\n                QUERY_ID,\\n                SESSION_ID,\\n                DATABASE_NAME,\\n                SCHEMA_NAME,\\n\\n                QUERY_TEXT,\\n                QUERY_TYPE,\\n                QUERY_TAG,\\n                QUERY_HASH,\\n                QUERY_HASH_VERSION,\\n                QUERY_PARAMETERIZED_HASH,\\n                QUERY_PARAMETERIZED_HASH_VERSION,\\n\\n                USER_NAME,\\n                ROLE_NAME,\\n\\n                WAREHOUSE_NAME,\\n                WAREHOUSE_TYPE,\\n\\n                EXECUTION_STATUS,\\n                ERROR_CODE,\\n                ERROR_MESSAGE,\\n\\n                // metrics\\n                RUNNING_TIME,\\n                EXECUTION_TIME,\\n                COMPILATION_TIME,\\n                TOTAL_ELAPSED_TIME,\\n                BYTES_WRITTEN_TO_RESULT,\\n                ROWS_WRITTEN_TO_RESULT,\\n            from cte_all_queries aq\\n            where\\n                ( array_size(DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])) = 0\\n            or array_contains(EXECUTION_STATUS::variant, DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])::array) )\\n        )\\n        select \\n            qh.END_TIME::timestamp_ltz                                                                                          as TIMESTAMP,\\n\\n            qh.query_id                                                                                                         as QUERY_ID,\\n            qh.session_id                                                                                                       as SESSION_ID,\\n\\n            CONCAT(\\n                'SQL query ',\\n                qh.execution_status,\\n                ' at ',\\n                COALESCE(qh.database_name, '')\\n            )                                                                                                                   as NAME,\\n            NAME                                                                                                                as _MESSAGE,\\n\\n            \\n            extract(epoch_nanosecond from qh.start_time)                                                                        as START_TIME,\\n            extract(epoch_nanosecond from qh.end_time)                                                                          as END_TIME,\\n\\n            \\n            OBJECT_CONSTRUCT(\\n                'db.namespace',                                             qh.database_name,\\n                'snowflake.warehouse.name',                                 qh.warehouse_name,\\n                'db.user',                                                  qh.user_name,\\n                'snowflake.role.name',                                      qh.role_name,\\n                'snowflake.query.execution_status',                         qh.execution_status\\n            )                                                                                                                   as DIMENSIONS,\\n            \\n            OBJECT_CONSTRUCT(\\n                'db.query.text',                                            qh.query_text,\\n                'db.operation.name',                                        qh.query_type,\\n                'session.id',                                               qh.session_id,\\n                'snowflake.query.id',                                       qh.query_id,\\n                'snowflake.query.tag',                                      qh.query_tag,\\n                'snowflake.query.hash',                                     qh.query_hash,\\n                'snowflake.query.hash_version',                             qh.query_hash_version,\\n                'snowflake.query.parametrized_hash',                        qh.query_parameterized_hash,\\n                'snowflake.query.parametrized_hash_version',                qh.query_parameterized_hash_version,\\n                'snowflake.error.code',                                     qh.error_code,\\n                'snowflake.error.message',                                  qh.error_message,\\n                'snowflake.warehouse.type',                                 qh.warehouse_type,\\n                'snowflake.schema.name',                                    qh.schema_name\\n            )                                                                                                                   as ATTRIBUTES,\\n            \\n            OBJECT_CONSTRUCT(\\n                'snowflake.time.running',                                   qh.running_time,\\n                'snowflake.time.execution',                                   qh.execution_time,\\n                'snowflake.time.compilation',                               qh.compilation_time,\\n                'snowflake.time.total_elapsed',                             qh.total_elapsed_time,\\n                'snowflake.data.written_to_result',                         qh.bytes_written_to_result,\\n                'snowflake.rows.written_to_result',                         qh.rows_written_to_result\\n            )                                                                                                                   as METRICS\\n        from \\n            cte_active_queries qh\\n        order by \\n            TIMESTAMP asc\",\n  \"db.snowflake.tables\": [\n    \"DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG\",\n    \"DTAGENT_DB.CONFIG.CONFIGURATIONS\"\n  ],\n  \"db.snowflake.views\": [],\n  \"session.id\": 20234875336090534,\n  \"snowflake.cluster_number\": 1,\n  \"snowflake.database.id\": 1868,\n  \"snowflake.query.hash\": \"0d8c82d99d518393458b4a68bc8c2930\",\n  \"snowflake.query.hash_version\": 2,\n  \"snowflake.query.id\": \"01bcb05d-0415-b618-0047-e383330c172e\",\n  \"snowflake.query.is_client_generated\": false,\n  \"snowflake.query.parametrized_hash\": \"0d8c82d99d518393458b4a68bc8c2930\",\n  \"snowflake.query.parametrized_hash_version\": 1,\n  \"snowflake.query.parent_id\": \"01bcb05d-0415-b618-0047-e383330c172a\",\n  \"snowflake.query.tag\": \"dt_snowagent.version:0.8.1.plugin:ActiveQueriesPlugin.2025-05-30T04:53:15.857Z\",\n  \"snowflake.query.transaction_id\": 0,\n  \"snowflake.release_version\": \"9.14.2\",\n  \"snowflake.role.type\": \"ROLE\",\n  \"snowflake.schema.id\": 40234,\n  \"snowflake.schema.name\": \"APP\",\n  \"snowflake.warehouse.cluster.number\": 1,\n  \"snowflake.warehouse.id\": 3726,\n  \"snowflake.warehouse.size\": \"X-Small\",\n  \"snowflake.warehouse.type\": \"STANDARD\"\n}", "METRICS": "{\n  \"snowflake.acceleration.data.scanned\": 0,\n  \"snowflake.acceleration.partitions.scanned\": 0,\n  \"snowflake.acceleration.scale_factor.max\": 0,\n  \"snowflake.credits.cloud_services\": 2.700000000000000e-05,\n  \"snowflake.data.deleted\": 0,\n  \"snowflake.data.read.from_result\": 0,\n  \"snowflake.data.scanned\": 0,\n  \"snowflake.data.scanned_from_cache\": 0.000000000000000e+00,\n  \"snowflake.data.sent_over_the_network\": 0,\n  \"snowflake.data.spilled.local\": 0,\n  \"snowflake.data.spilled.remote\": 0,\n  \"snowflake.data.transferred.inbound\": 0,\n  \"snowflake.data.transferred.outbound\": 0,\n  \"snowflake.data.written\": 0,\n  \"snowflake.data.written_to_result\": 640,\n  \"snowflake.external_functions.data.received\": 0,\n  \"snowflake.external_functions.data.sent\": 0,\n  \"snowflake.external_functions.invocations\": 0,\n  \"snowflake.external_functions.rows.received\": 0,\n  \"snowflake.external_functions.rows.sent\": 0,\n  \"snowflake.load.used\": 100,\n  \"snowflake.partitions.scanned\": 0,\n  \"snowflake.partitions.total\": 0,\n  \"snowflake.rows.deleted\": 0,\n  \"snowflake.rows.inserted\": 0,\n  \"snowflake.rows.unloaded\": 0,\n  \"snowflake.rows.updated\": 0,\n  \"snowflake.rows.written_to_result\": 798,\n  \"snowflake.time.child_queries_wait\": 0,\n  \"snowflake.time.compilation\": 158,\n  \"snowflake.time.execution\": 6578,\n  \"snowflake.time.list_external_files\": 0,\n  \"snowflake.time.queued.overload\": 0,\n  \"snowflake.time.queued.provisioning\": 0,\n  \"snowflake.time.repair\": 0,\n  \"snowflake.time.total_elapsed\": 6736,\n  \"snowflake.time.transaction_blocked\": 0\n}", "IS_PARENT": true, "IS_ROOT": false}
{"QUERY_ID": "01bcb05d-0415-b618-0047-e383330c172a", "QUERY_OPERATOR_STATS": null, "PARENT_QUERY_ID": null, "SESSION_ID": 20234875336090534, "NAME": "call DTAGENT_DB", "START_TIME": 1760681131569144000, "END_TIME": 1760681138581144000, "_SPAN_ID": "4a57ce274789b2ec", "_TRACE_ID": "01bcb05d68938b78428142dea30a6160", "STATUS_CODE": "OK", "DIMENSIONS": "{\n  \"db.namespace\": \"DTAGENT_DB\",\n  \"db.operation.name\": \"CALL\",\n  \"db.user\": \"SYSTEM\",\n  \"snowflake.query.execution_status\": \"SUCCESS\",\n  \"snowflake.role.name\": \"DTAGENT_ADMIN\",\n  \"snowflake.warehouse.name\": \"DTAGENT_WH\"\n}", "ATTRIBUTES": "{\n  \"db.query.text\": \"CALL DTAGENT_DB.APP.F_ACTIVE_QUERIES_INSTRUMENTED();\\n\",\n  \"session.id\": 20234875336090534,\n  \"snowflake.cluster_number\": 1,\n  \"snowflake.database.id\": 1868,\n  \"snowflake.query.hash\": \"e86eb140052655351696b76a32722b70\",\n  \"snowflake.query.hash_version\": 2,\n  \"snowflake.query.id\": \"01bcb05d-0415-b618-0047-e383330c172a\",\n  \"snowflake.query.is_client_generated\": false,\n  \"snowflake.query.parametrized_hash\": \"e86eb140052655351696b76a32722b70\",\n  \"snowflake.query.parametrized_hash_version\": 1,\n  \"snowflake.query.tag\": \"dt_snowagent.version:0.8.1.plugin:ActiveQueriesPlugin.2025-05-30T04:53:15.857Z\",\n  \"snowflake.query.transaction_id\": 0,\n  \"snowflake.release_version\": \"9.14.2\",\n  \"snowflake.role.type\": \"ROLE\",\n  \"snowflake.schema.id\": 40234,\n  \"snowflake.schema.name\": \"APP\",\n  \"snowflake.warehouse.cluster.number\": 1,\n  \"snowflake.warehouse.id\": 3726,\n  \"snowflake.warehouse.size\": \"X-Small\",\n  \"snowflake.warehouse.type\": \"STANDARD\"\n}", "METRICS": "{\n  \"snowflake.acceleration.data.scanned\": 0,\n  \"snowflake.acceleration.partitions.scanned\": 0,\n  \"snowflake.acceleration.scale_factor.max\": 0,\n  \"snowflake.credits.cloud_services\": 1.000000000000000e-05,\n  \"snowflake.data.deleted\": 0,\n  \"snowflake.data.read.from_result\": 0,\n  \"snowflake.data.scanned\": 0,\n  \"snowflake.data.scanned_from_cache\": 0.000000000000000e+00,\n  \"snowflake.data.sent_over_the_network\": 0,\n  \"snowflake.data.spilled.local\": 0,\n  \"snowflake.data.spilled.remote\": 0,\n  \"snowflake.data.transferred.inbound\": 0,\n  \"snowflake.data.transferred.outbound\": 0,\n  \"snowflake.data.written\": 0,\n  \"snowflake.data.written_to_result\": 640,\n  \"snowflake.external_functions.data.received\": 0,\n  \"snowflake.external_functions.data.sent\": 0,\n  \"snowflake.external_functions.invocations\": 0,\n  \"snowflake.external_functions.rows.received\": 0,\n  \"snowflake.external_functions.rows.sent\": 0,\n  \"snowflake.load.used\": 100,\n  \"snowflake.partitions.scanned\": 0,\n  \"snowflake.partitions.total\": 0,\n  \"snowflake.rows.deleted\": 0,\n  \"snowflake.rows.inserted\": 0,\n  \"snowflake.rows.unloaded\": 0,\n  \"snowflake.rows.updated\": 0,\n  \"snowflake.rows.written_to_result\": 798,\n  \"snowflake.time.child_queries_wait\": 0,\n  \"snowflake.time.compilation\": 43,\n  \"snowflake.time.execution\": 6969,\n  \"snowflake.time.list_external_files\": 0,\n  \"snowflake.time.queued.overload\": 0,\n  \"snowflake.time.queued.provisioning\": 0,\n  \"snowflake.time.repair\": 0,\n  \"snowflake.time.total_elapsed\": 7012,\n  \"snowflake.time.transaction_blocked\": 0\n}", "IS_PARENT": true, "IS_ROOT": true}
