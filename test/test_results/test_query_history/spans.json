[
  {
    "snowflake.acceleration.data.scanned": 0,
    "snowflake.acceleration.partitions.scanned": 0,
    "snowflake.acceleration.scale_factor.max": 0,
    "snowflake.credits.cloud_services": 9.2e-05,
    "snowflake.data.deleted": 0,
    "snowflake.data.read.from_result": 0,
    "snowflake.data.scanned": 5640704,
    "snowflake.data.scanned_from_cache": 0.0,
    "snowflake.data.sent_over_the_network": 0,
    "snowflake.data.spilled.local": 0,
    "snowflake.data.spilled.remote": 0,
    "snowflake.data.transferred.inbound": 0,
    "snowflake.data.transferred.outbound": 0,
    "snowflake.data.written": 0,
    "snowflake.data.written_to_result": 117512,
    "snowflake.external_functions.data.received": 0,
    "snowflake.external_functions.data.sent": 0,
    "snowflake.external_functions.invocations": 0,
    "snowflake.external_functions.rows.received": 0,
    "snowflake.external_functions.rows.sent": 0,
    "snowflake.load.used": 100,
    "snowflake.partitions.scanned": 47,
    "snowflake.partitions.total": 43,
    "snowflake.rows.deleted": 0,
    "snowflake.rows.inserted": 0,
    "snowflake.rows.unloaded": 0,
    "snowflake.rows.updated": 0,
    "snowflake.rows.written_to_result": 798,
    "snowflake.time.child_queries_wait": 0,
    "snowflake.time.compilation": 520,
    "snowflake.time.execution": 1381,
    "snowflake.time.list_external_files": 19,
    "snowflake.time.queued.overload": 0,
    "snowflake.time.queued.provisioning": 0,
    "snowflake.time.repair": 0,
    "snowflake.time.total_elapsed": 1920,
    "snowflake.time.transaction_blocked": 0,
    "db.query.text": "with cte_all_queries as (\n            (\n                select * from TABLE(result_scan(:QID_0))\n            )\n            union all\n            (\n                select * from TABLE(result_scan(:QID_1))\n                where END_TIME > DTAGENT_DB.APP.F_LAST_PROCESSED_TS('active_queries')\n            )\n        )\n        , cte_active_queries as (\n            select \n                START_TIME,\n                END_TIME,\n\n                QUERY_ID,\n                SESSION_ID,\n                DATABASE_NAME,\n                SCHEMA_NAME,\n\n                QUERY_TEXT,\n                QUERY_TYPE,\n                QUERY_TAG,\n                QUERY_HASH,\n                QUERY_HASH_VERSION,\n                QUERY_PARAMETERIZED_HASH,\n                QUERY_PARAMETERIZED_HASH_VERSION,\n\n                USER_NAME,\n                ROLE_NAME,\n\n                WAREHOUSE_NAME,\n                WAREHOUSE_TYPE,\n\n                EXECUTION_STATUS,\n                ERROR_CODE,\n                ERROR_MESSAGE,\n\n                // metrics\n                RUNNING_TIME,\n                EXECUTION_TIME,\n                COMPILATION_TIME,\n                TOTAL_ELAPSED_TIME,\n                BYTES_WRITTEN_TO_RESULT,\n                ROWS_WRITTEN_TO_RESULT,\n            from cte_all_queries aq\n            where\n                ( array_size(DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])) = 0\n            or array_contains(EXECUTION_STATUS::variant, DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])::array) )\n        )\n        select \n            qh.END_TIME::timestamp_ltz                                                                                          as TIMESTAMP,\n\n            qh.query_id                                                                                                         as QUERY_ID,\n            qh.session_id                                                                                                       as SESSION_ID,\n\n            CONCAT(\n                'SQL query ',\n                qh.execution_status,\n                ' at ',\n                COALESCE(qh.database_name, '')\n            )                                                                                                                   as NAME,\n            NAME                                                                                                                as _MESSAGE,\n\n            \n            extract(epoch_nanosecond from qh.start_time)                                                                        as START_TIME,\n            extract(epoch_nanosecond from qh.end_time)                                                                          as END_TIME,\n\n            \n            OBJECT_CONSTRUCT(\n                'db.namespace',                                             qh.database_name,\n                'snowflake.warehouse.name',                                 qh.warehouse_name,\n                'db.user',                                                  qh.user_name,\n                'snowflake.role.name',                                      qh.role_name,\n                'snowflake.query.execution_status',                         qh.execution_status\n            )                                                                                                                   as DIMENSIONS,\n            \n            OBJECT_CONSTRUCT(\n                'db.query.text',                                            qh.query_text,\n                'db.operation.name',                                        qh.query_type,\n                'session.id',                                               qh.session_id,\n                'snowflake.query.id',                                       qh.query_id,\n                'snowflake.query.tag',                                      qh.query_tag,\n                'snowflake.query.hash',                                     qh.query_hash,\n                'snowflake.query.hash_version',                             qh.query_hash_version,\n                'snowflake.query.parametrized_hash',                        qh.query_parameterized_hash,\n                'snowflake.query.parametrized_hash_version',                qh.query_parameterized_hash_version,\n                'snowflake.error.code',                                     qh.error_code,\n                'snowflake.error.message',                                  qh.error_message,\n                'snowflake.warehouse.type',                                 qh.warehouse_type,\n                'snowflake.schema.name',                                    qh.schema_name\n            )                                                                                                                   as ATTRIBUTES,\n            \n            OBJECT_CONSTRUCT(\n                'snowflake.time.running',                                   qh.running_time,\n                'snowflake.time.execution',                                   qh.execution_time,\n                'snowflake.time.compilation',                               qh.compilation_time,\n                'snowflake.time.total_elapsed',                             qh.total_elapsed_time,\n                'snowflake.data.written_to_result',                         qh.bytes_written_to_result,\n                'snowflake.rows.written_to_result',                         qh.rows_written_to_result\n            )                                                                                                                   as METRICS\n        from \n            cte_active_queries qh\n        order by \n            TIMESTAMP asc",
    "db.snowflake.tables": [
      "DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG",
      "DTAGENT_DB.CONFIG.CONFIGURATIONS"
    ],
    "session.id": 20234875336090534,
    "snowflake.cluster_number": 1,
    "snowflake.database.id": 1868,
    "snowflake.query.hash": "dbf5cf366b64603513aa8097d5d3174c",
    "snowflake.query.hash_version": 2,
    "snowflake.query.id": "01bcb05d-0415-b618-0047-e383330c174a",
    "snowflake.query.is_client_generated": false,
    "snowflake.query.parametrized_hash": "dbf5cf366b64603513aa8097d5d3174c",
    "snowflake.query.parametrized_hash_version": 1,
    "snowflake.query.parent_id": "01bcb05d-0415-b618-0047-e383330c172e",
    "snowflake.query.tag": "dt_snowagent.version:0.8.1.plugin:ActiveQueriesPlugin.2025-05-30T04:53:15.857Z",
    "snowflake.query.transaction_id": 0,
    "snowflake.release_version": "9.14.2",
    "snowflake.role.type": "ROLE",
    "snowflake.schema.id": 40234,
    "snowflake.schema.name": "APP",
    "snowflake.warehouse.cluster.number": 1,
    "snowflake.warehouse.id": 3726,
    "snowflake.warehouse.size": "X-Small",
    "snowflake.warehouse.type": "STANDARD",
    "db.collection.name": "DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG",
    "db.namespace": "DTAGENT_DB",
    "db.operation.name": "SELECT",
    "db.snowflake.dbs": [
      "DTAGENT_DB"
    ],
    "db.user": "SYSTEM",
    "snowflake.query.execution_status": "SUCCESS",
    "snowflake.role.name": "DTAGENT_ADMIN",
    "snowflake.warehouse.name": "DTAGENT_WH",
    "dsoa.run.context": "query_history",
    "dsoa.run.plugin": "test_query_history",
    "dsoa.debug.span.events.added": 0,
    "dsoa.debug.span.events.failed": 0
  },
  {
    "snowflake.acceleration.data.scanned": 0,
    "snowflake.acceleration.partitions.scanned": 0,
    "snowflake.acceleration.scale_factor.max": 0,
    "snowflake.credits.cloud_services": 2.7e-05,
    "snowflake.data.deleted": 0,
    "snowflake.data.read.from_result": 0,
    "snowflake.data.scanned": 0,
    "snowflake.data.scanned_from_cache": 0.0,
    "snowflake.data.sent_over_the_network": 0,
    "snowflake.data.spilled.local": 0,
    "snowflake.data.spilled.remote": 0,
    "snowflake.data.transferred.inbound": 0,
    "snowflake.data.transferred.outbound": 0,
    "snowflake.data.written": 0,
    "snowflake.data.written_to_result": 640,
    "snowflake.external_functions.data.received": 0,
    "snowflake.external_functions.data.sent": 0,
    "snowflake.external_functions.invocations": 0,
    "snowflake.external_functions.rows.received": 0,
    "snowflake.external_functions.rows.sent": 0,
    "snowflake.load.used": 100,
    "snowflake.partitions.scanned": 0,
    "snowflake.partitions.total": 0,
    "snowflake.rows.deleted": 0,
    "snowflake.rows.inserted": 0,
    "snowflake.rows.unloaded": 0,
    "snowflake.rows.updated": 0,
    "snowflake.rows.written_to_result": 798,
    "snowflake.time.child_queries_wait": 0,
    "snowflake.time.compilation": 158,
    "snowflake.time.execution": 6578,
    "snowflake.time.list_external_files": 0,
    "snowflake.time.queued.overload": 0,
    "snowflake.time.queued.provisioning": 0,
    "snowflake.time.repair": 0,
    "snowflake.time.total_elapsed": 6736,
    "snowflake.time.transaction_blocked": 0,
    "db.query.text": "with cte_all_queries as (\n            (\n                select * from TABLE(DTAGENT_DB.APP.F_GET_RUNNING_QUERIES())\n            )\n            union all\n            (\n                select * from TABLE(DTAGENT_DB.APP.F_GET_FINISHED_QUERIES())\n                where END_TIME > DTAGENT_DB.APP.F_LAST_PROCESSED_TS('active_queries')\n            )\n        )\n        , cte_active_queries as (\n            select \n                START_TIME,\n                END_TIME,\n\n                QUERY_ID,\n                SESSION_ID,\n                DATABASE_NAME,\n                SCHEMA_NAME,\n\n                QUERY_TEXT,\n                QUERY_TYPE,\n                QUERY_TAG,\n                QUERY_HASH,\n                QUERY_HASH_VERSION,\n                QUERY_PARAMETERIZED_HASH,\n                QUERY_PARAMETERIZED_HASH_VERSION,\n\n                USER_NAME,\n                ROLE_NAME,\n\n                WAREHOUSE_NAME,\n                WAREHOUSE_TYPE,\n\n                EXECUTION_STATUS,\n                ERROR_CODE,\n                ERROR_MESSAGE,\n\n                // metrics\n                RUNNING_TIME,\n                EXECUTION_TIME,\n                COMPILATION_TIME,\n                TOTAL_ELAPSED_TIME,\n                BYTES_WRITTEN_TO_RESULT,\n                ROWS_WRITTEN_TO_RESULT,\n            from cte_all_queries aq\n            where\n                ( array_size(DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])) = 0\n            or array_contains(EXECUTION_STATUS::variant, DTAGENT_DB.APP.F_GET_CONFIG_VALUE('plugins.active_queries.report_execution_status', [])::array) )\n        )\n        select \n            qh.END_TIME::timestamp_ltz                                                                                          as TIMESTAMP,\n\n            qh.query_id                                                                                                         as QUERY_ID,\n            qh.session_id                                                                                                       as SESSION_ID,\n\n            CONCAT(\n                'SQL query ',\n                qh.execution_status,\n                ' at ',\n                COALESCE(qh.database_name, '')\n            )                                                                                                                   as NAME,\n            NAME                                                                                                                as _MESSAGE,\n\n            \n            extract(epoch_nanosecond from qh.start_time)                                                                        as START_TIME,\n            extract(epoch_nanosecond from qh.end_time)                                                                          as END_TIME,\n\n            \n            OBJECT_CONSTRUCT(\n                'db.namespace',                                             qh.database_name,\n                'snowflake.warehouse.name',                                 qh.warehouse_name,\n                'db.user',                                                  qh.user_name,\n                'snowflake.role.name',                                      qh.role_name,\n                'snowflake.query.execution_status',                         qh.execution_status\n            )                                                                                                                   as DIMENSIONS,\n            \n            OBJECT_CONSTRUCT(\n                'db.query.text',                                            qh.query_text,\n                'db.operation.name',                                        qh.query_type,\n                'session.id',                                               qh.session_id,\n                'snowflake.query.id',                                       qh.query_id,\n                'snowflake.query.tag',                                      qh.query_tag,\n                'snowflake.query.hash',                                     qh.query_hash,\n                'snowflake.query.hash_version',                             qh.query_hash_version,\n                'snowflake.query.parametrized_hash',                        qh.query_parameterized_hash,\n                'snowflake.query.parametrized_hash_version',                qh.query_parameterized_hash_version,\n                'snowflake.error.code',                                     qh.error_code,\n                'snowflake.error.message',                                  qh.error_message,\n                'snowflake.warehouse.type',                                 qh.warehouse_type,\n                'snowflake.schema.name',                                    qh.schema_name\n            )                                                                                                                   as ATTRIBUTES,\n            \n            OBJECT_CONSTRUCT(\n                'snowflake.time.running',                                   qh.running_time,\n                'snowflake.time.execution',                                   qh.execution_time,\n                'snowflake.time.compilation',                               qh.compilation_time,\n                'snowflake.time.total_elapsed',                             qh.total_elapsed_time,\n                'snowflake.data.written_to_result',                         qh.bytes_written_to_result,\n                'snowflake.rows.written_to_result',                         qh.rows_written_to_result\n            )                                                                                                                   as METRICS\n        from \n            cte_active_queries qh\n        order by \n            TIMESTAMP asc",
    "db.snowflake.tables": [
      "DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG",
      "DTAGENT_DB.CONFIG.CONFIGURATIONS"
    ],
    "session.id": 20234875336090534,
    "snowflake.cluster_number": 1,
    "snowflake.database.id": 1868,
    "snowflake.query.hash": "0d8c82d99d518393458b4a68bc8c2930",
    "snowflake.query.hash_version": 2,
    "snowflake.query.id": "01bcb05d-0415-b618-0047-e383330c172e",
    "snowflake.query.is_client_generated": false,
    "snowflake.query.parametrized_hash": "0d8c82d99d518393458b4a68bc8c2930",
    "snowflake.query.parametrized_hash_version": 1,
    "snowflake.query.parent_id": "01bcb05d-0415-b618-0047-e383330c172a",
    "snowflake.query.tag": "dt_snowagent.version:0.8.1.plugin:ActiveQueriesPlugin.2025-05-30T04:53:15.857Z",
    "snowflake.query.transaction_id": 0,
    "snowflake.release_version": "9.14.2",
    "snowflake.role.type": "ROLE",
    "snowflake.schema.id": 40234,
    "snowflake.schema.name": "APP",
    "snowflake.warehouse.cluster.number": 1,
    "snowflake.warehouse.id": 3726,
    "snowflake.warehouse.size": "X-Small",
    "snowflake.warehouse.type": "STANDARD",
    "db.collection.name": "DTAGENT_DB.STATUS.PROCESSED_MEASUREMENTS_LOG",
    "db.namespace": "DTAGENT_DB",
    "db.operation.name": "CALL",
    "db.snowflake.dbs": [
      "DTAGENT_DB"
    ],
    "db.user": "SYSTEM",
    "snowflake.query.execution_status": "SUCCESS",
    "snowflake.role.name": "DTAGENT_ADMIN",
    "snowflake.warehouse.name": "DTAGENT_WH",
    "dsoa.run.context": "query_history",
    "dsoa.run.plugin": "test_query_history",
    "dsoa.debug.span.events.added": 0,
    "dsoa.debug.span.events.failed": 0
  },
  {
    "snowflake.acceleration.data.scanned": 0,
    "snowflake.acceleration.partitions.scanned": 0,
    "snowflake.acceleration.scale_factor.max": 0,
    "snowflake.credits.cloud_services": 1e-05,
    "snowflake.data.deleted": 0,
    "snowflake.data.read.from_result": 0,
    "snowflake.data.scanned": 0,
    "snowflake.data.scanned_from_cache": 0.0,
    "snowflake.data.sent_over_the_network": 0,
    "snowflake.data.spilled.local": 0,
    "snowflake.data.spilled.remote": 0,
    "snowflake.data.transferred.inbound": 0,
    "snowflake.data.transferred.outbound": 0,
    "snowflake.data.written": 0,
    "snowflake.data.written_to_result": 640,
    "snowflake.external_functions.data.received": 0,
    "snowflake.external_functions.data.sent": 0,
    "snowflake.external_functions.invocations": 0,
    "snowflake.external_functions.rows.received": 0,
    "snowflake.external_functions.rows.sent": 0,
    "snowflake.load.used": 100,
    "snowflake.partitions.scanned": 0,
    "snowflake.partitions.total": 0,
    "snowflake.rows.deleted": 0,
    "snowflake.rows.inserted": 0,
    "snowflake.rows.unloaded": 0,
    "snowflake.rows.updated": 0,
    "snowflake.rows.written_to_result": 798,
    "snowflake.time.child_queries_wait": 0,
    "snowflake.time.compilation": 43,
    "snowflake.time.execution": 6969,
    "snowflake.time.list_external_files": 0,
    "snowflake.time.queued.overload": 0,
    "snowflake.time.queued.provisioning": 0,
    "snowflake.time.repair": 0,
    "snowflake.time.total_elapsed": 7012,
    "snowflake.time.transaction_blocked": 0,
    "db.query.text": "CALL DTAGENT_DB.APP.F_ACTIVE_QUERIES_INSTRUMENTED();\n",
    "session.id": 20234875336090534,
    "snowflake.cluster_number": 1,
    "snowflake.database.id": 1868,
    "snowflake.query.hash": "e86eb140052655351696b76a32722b70",
    "snowflake.query.hash_version": 2,
    "snowflake.query.id": "01bcb05d-0415-b618-0047-e383330c172a",
    "snowflake.query.is_client_generated": false,
    "snowflake.query.parametrized_hash": "e86eb140052655351696b76a32722b70",
    "snowflake.query.parametrized_hash_version": 1,
    "snowflake.query.tag": "dt_snowagent.version:0.8.1.plugin:ActiveQueriesPlugin.2025-05-30T04:53:15.857Z",
    "snowflake.query.transaction_id": 0,
    "snowflake.release_version": "9.14.2",
    "snowflake.role.type": "ROLE",
    "snowflake.schema.id": 40234,
    "snowflake.schema.name": "APP",
    "snowflake.warehouse.cluster.number": 1,
    "snowflake.warehouse.id": 3726,
    "snowflake.warehouse.size": "X-Small",
    "snowflake.warehouse.type": "STANDARD",
    "db.namespace": "DTAGENT_DB",
    "db.operation.name": "CALL",
    "db.user": "SYSTEM",
    "snowflake.query.execution_status": "SUCCESS",
    "snowflake.role.name": "DTAGENT_ADMIN",
    "snowflake.warehouse.name": "DTAGENT_WH",
    "dsoa.run.context": "query_history",
    "dsoa.run.plugin": "test_query_history",
    "dsoa.debug.span.events.added": 0,
    "dsoa.debug.span.events.failed": 0
  }
]